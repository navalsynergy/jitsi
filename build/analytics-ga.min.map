{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./react/features/analytics/handlers/GoogleAnalyticsHandler.js","webpack:///./react/features/base/util/helpers.js","webpack:///./react/features/analytics/handlers/AbstractHandler.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","globalNS","window","JitsiMeetJS","app","analyticsHandlers","push","constructor","options","this","_enabled","_whiteListedEvents","whiteListedEvents","_blackListedEvents","blackListedEvents","_extractName","event","type","action","actionSubject","source","_shouldIgnore","Array","isArray","indexOf","super","_userProperties","googleAnalyticsTrackingId","Error","_initGoogleAnalytics","a","document","q","arguments","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","ga","_extractValue","attributes","Math","round","parseFloat","_extractLabel","labelsArray","keys","map","_userPropertiesString","join","setUserProperties","userProps","filter","sendEvent","gaEvent","isNaN","eventValue"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,SAIjBlC,EAAoBA,EAAoBmC,EAAI,G,sCC6DrD,MAAMC,GC5BGC,OAAOC,cACRD,OAAOC,YAAc,IAGpBD,OAAOC,YAAYC,MACpBF,OAAOC,YAAYC,IAAM,IAGtBF,OAAOC,YAAYC,KDsB9BH,EAASI,kBAAoBJ,EAASI,mBAAqB,GAC3DJ,EAASI,kBAAkBC,KAzI3B,cENe,MAMXC,YAAYC,EAAU,IAClBC,KAAKC,UAAW,EAChBD,KAAKE,mBAAqBH,EAAQI,kBAMlCH,KAAKI,mBAAqB,IAClBL,EAAQM,mBAAqB,GACjC,UAAW,YAAa,gBAAiB,mBAAoB,sBAAuB,oBACpF,eAAgB,6BAUxBC,aAAaC,GAET,GAAmB,SAAfA,EAAMC,KACN,OAAOD,EAAMxC,KAGjB,MAAM,OACF0C,EADE,cAEFC,EAFE,OAGFC,GACAJ,EASJ,IAAIxC,EAAO0C,EASX,OAPIC,GAAiBA,IAAkBD,IACnC1C,EAAQ,GAAE2C,KAAiBD,KAE3BE,GAAUA,IAAWF,IACrB1C,EAAQ,GAAE4C,KAAU5C,KAGjBA,EASX6C,cAAcL,GACV,IAAKA,IAAUP,KAAKC,SAChB,OAAO,EAGX,MAAMlC,EAAOiC,KAAKM,aAAaC,GAE/B,OAAIM,MAAMC,QAAQd,KAAKE,qBAC+B,IAA3CF,KAAKE,mBAAmBa,QAAQhD,KAGvC8C,MAAMC,QAAQd,KAAKI,sBAC+B,IAA3CJ,KAAKI,mBAAmBW,QAAQhD,KF7D/C+B,YAAYC,GAKR,GAJAiB,MAAMjB,GAENC,KAAKiB,gBAAkB,IAElBlB,EAAQmB,0BACT,MAAM,IAAIC,MAAM,iEAGpBnB,KAAKC,UAAW,EAChBD,KAAKoB,qBAAqBrB,GAW9BqB,qBAAqBrB,GAKjB,IAAUvC,EAAE+B,EAAEtB,EAAIK,EAAE+C,EAAEzD,EAAZJ,EAEPiC,OAFSF,EAEF+B,SAFIrD,EAEK,SAFDK,EAEoD,KAF7Cd,EAAC,sBAA0Bc,EAAEd,EAAC,GAAIA,EAAC,IAAK,YAC5DA,EAAC,GAAI+D,EAAE/D,EAAC,GAAI+D,GAAG,IAAI1B,KAAK2B,YAAYhE,EAAC,GAAIC,EAAE,EAAE,IAAIgE,KAAOJ,EAAE9B,EAAEmC,cAAczD,GAAGL,EAAE2B,EAAEoC,qBAAqB1D,GAAG,GAAGoD,EAAEO,MAAM,EAAEP,EAAEQ,IACjG,0CADuGjE,EAAEkE,WAAWC,aAAaV,EAAEzD,GAG/JoE,GAAG,SAAUjC,EAAQmB,0BAA2B,QAChDc,GAAG,OAAQ,YAafC,cAAc1B,GACV,IAAI9B,EAAQ8B,GAASA,EAAM2B,YAAc3B,EAAM2B,WAAWzD,MAK1D,OAFAA,EAAQ0D,KAAKC,MAAMC,WAAW5D,IAEvBA,EAYX6D,cAAc/B,GACV,MAAM,WAAE2B,EAAa,IAAO3B,EACtBgC,EACArE,OAAOsE,KAAKN,GAAYO,IAAI1D,GAAQ,GAAEA,KAAOmD,EAAWnD,MAI9D,OAFAwD,EAAY1C,KAAKG,KAAK0C,uBAEfH,EAAYI,KAAK,KAS5BC,kBAAkBC,EAAY,IAC1B,IAAK7C,KAAKC,SACN,OAMJ,MAAM6C,EAAS,CAAE,aAAc,kBAE/B9C,KAAK0C,sBACCxE,OAAOsE,KAAKK,GACTC,OAAO/D,IAAgC,IAAzB+D,EAAO/B,QAAQhC,IAC7B0D,IAAI1D,GAAQ,aAAYA,KAAO8D,EAAU9D,MACzC4D,KAAK,KAYlBI,UAAUxC,GACN,GAAIP,KAAKY,cAAcL,GACnB,OAGJ,MAAMyC,EAAU,CACZ,cAAiB,aACjB,YAAehD,KAAKM,aAAaC,GACjC,WAAcP,KAAKsC,cAAc/B,IAE/B9B,EAAQuB,KAAKiC,cAAc1B,GAE5B0C,MAAMxE,KACPuE,EAAQE,WAAazE,GAGzBuD,GAAG,OAAQ,QAASgB","file":"analytics-ga.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/libs/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/* global ga */\r\n\r\nimport { getJitsiMeetGlobalNS } from '../../base/util';\r\n\r\nimport AbstractHandler from './AbstractHandler';\r\n\r\n/**\r\n * Analytics handler for Google Analytics.\r\n */\r\nclass GoogleAnalyticsHandler extends AbstractHandler {\r\n\r\n    /**\r\n     * Creates new instance of the GA analytics handler.\r\n     *\r\n     * @param {Object} options -\r\n     * @param {string} options.googleAnalyticsTrackingId - The GA track id\r\n     * required by the GA API.\r\n     */\r\n    constructor(options) {\r\n        super(options);\r\n\r\n        this._userProperties = {};\r\n\r\n        if (!options.googleAnalyticsTrackingId) {\r\n            throw new Error('Failed to initialize Google Analytics handler, no tracking ID');\r\n        }\r\n\r\n        this._enabled = true;\r\n        this._initGoogleAnalytics(options);\r\n    }\r\n\r\n    /**\r\n     * Initializes the ga object.\r\n     *\r\n     * @param {Object} options -\r\n     * @param {string} options.googleAnalyticsTrackingId - The GA track id\r\n     * required by the GA API.\r\n     * @returns {void}\r\n     */\r\n    _initGoogleAnalytics(options) {\r\n        /**\r\n         * TODO: Keep this local, there's no need to add it to window.\r\n         */\r\n        /* eslint-disable */\r\n        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\r\n            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\r\n        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\r\n        /* eslint-enable */\r\n        ga('create', options.googleAnalyticsTrackingId, 'auto');\r\n        ga('send', 'pageview');\r\n    }\r\n\r\n    /**\r\n     * Extracts the integer to use for a Google Analytics event's value field\r\n     * from a lib-jitsi-meet analytics event.\r\n     *\r\n     * @param {Object} event - The lib-jitsi-meet analytics event.\r\n     * @returns {number} - The integer to use for the 'value' of a Google\r\n     * analytics event, or NaN if the lib-jitsi-meet event doesn't contain a\r\n     * suitable value.\r\n     * @private\r\n     */\r\n    _extractValue(event) {\r\n        let value = event && event.attributes && event.attributes.value;\r\n\r\n        // Try to extract an integer from the \"value\" attribute.\r\n        value = Math.round(parseFloat(value));\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Extracts the string to use for a Google Analytics event's label field\r\n     * from a lib-jitsi-meet analytics event.\r\n     *\r\n     * @param {Object} event - The lib-jitsi-meet analytics event.\r\n     * @returns {string} - The string to use for the 'label' of a Google\r\n     * analytics event.\r\n     * @private\r\n     */\r\n    _extractLabel(event) {\r\n        const { attributes = {} } = event;\r\n        const labelsArray\r\n            = Object.keys(attributes).map(key => `${key}=${attributes[key]}`);\r\n\r\n        labelsArray.push(this._userPropertiesString);\r\n\r\n        return labelsArray.join('&');\r\n    }\r\n\r\n    /**\r\n     * Sets the permanent properties for the current session.\r\n     *\r\n     * @param {Object} userProps - The permanent portperties.\r\n     * @returns {void}\r\n     */\r\n    setUserProperties(userProps = {}) {\r\n        if (!this._enabled) {\r\n            return;\r\n        }\r\n\r\n        // The label field is limited to 500B. We will concatenate all\r\n        // attributes of the event, except the user agent because it may be\r\n        // lengthy and is probably included from elsewhere.\r\n        const filter = [ 'user_agent', 'callstats_name' ];\r\n\r\n        this._userPropertiesString\r\n            = Object.keys(userProps)\r\n                .filter(key => filter.indexOf(key) === -1)\r\n                .map(key => `permanent_${key}=${userProps[key]}`)\r\n                .join('&');\r\n    }\r\n\r\n    /**\r\n     * This is the entry point of the API. The function sends an event to\r\n     * google analytics. The format of the event is described in\r\n     * analyticsAdapter in lib-jitsi-meet.\r\n     *\r\n     * @param {Object} event - The event in the format specified by\r\n     * lib-jitsi-meet.\r\n     * @returns {void}\r\n     */\r\n    sendEvent(event) {\r\n        if (this._shouldIgnore(event)) {\r\n            return;\r\n        }\r\n\r\n        const gaEvent = {\r\n            'eventCategory': 'jitsi-meet',\r\n            'eventAction': this._extractName(event),\r\n            'eventLabel': this._extractLabel(event)\r\n        };\r\n        const value = this._extractValue(event);\r\n\r\n        if (!isNaN(value)) {\r\n            gaEvent.eventValue = value;\r\n        }\r\n\r\n        ga('send', 'event', gaEvent);\r\n    }\r\n\r\n}\r\n\r\nconst globalNS = getJitsiMeetGlobalNS();\r\n\r\nglobalNS.analyticsHandlers = globalNS.analyticsHandlers || [];\r\nglobalNS.analyticsHandlers.push(GoogleAnalyticsHandler);\r\n","// @flow\r\n\r\n/**\r\n * A helper function that behaves similar to Object.assign, but only reassigns a\r\n * property in target if it's defined in source.\r\n *\r\n * @param {Object} target - The target object to assign the values into.\r\n * @param {Object} source - The source object.\r\n * @returns {Object}\r\n */\r\nexport function assignIfDefined(target: Object, source: Object) {\r\n    const to = Object(target);\r\n\r\n    for (const nextKey in source) {\r\n        if (source.hasOwnProperty(nextKey)) {\r\n            const value = source[nextKey];\r\n\r\n            if (typeof value !== 'undefined') {\r\n                to[nextKey] = value;\r\n            }\r\n        }\r\n    }\r\n\r\n    return to;\r\n}\r\n\r\n/**\r\n * Tries to copy a given text to the clipboard.\r\n * Returns true if the action succeeds.\r\n *\r\n * @param {string} textToCopy - Text to be copied.\r\n * @returns {boolean}\r\n */\r\nexport function copyText(textToCopy: string) {\r\n    const fakeTextArea = document.createElement('textarea');\r\n    let result;\r\n\r\n    // $FlowFixMe\r\n    document.body.appendChild(fakeTextArea);\r\n    fakeTextArea.value = textToCopy;\r\n    fakeTextArea.select();\r\n\r\n    try {\r\n        result = document.execCommand('copy');\r\n    } catch (err) {\r\n        result = false;\r\n    }\r\n\r\n    // $FlowFixMe\r\n    document.body.removeChild(fakeTextArea);\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Creates a deferred object.\r\n *\r\n * @returns {{promise, resolve, reject}}\r\n */\r\nexport function createDeferred(): Object {\r\n    const deferred = {};\r\n\r\n    deferred.promise = new Promise((resolve, reject) => {\r\n        deferred.resolve = resolve;\r\n        deferred.reject = reject;\r\n    });\r\n\r\n    return deferred;\r\n}\r\n\r\nconst MATCH_OPERATOR_REGEXP = /[|\\\\{}()[\\]^$+*?.-]/g;\r\n\r\n/**\r\n * Escape RegExp special characters.\r\n *\r\n * Based on https://github.com/sindresorhus/escape-string-regexp.\r\n *\r\n * @param {string} s - The regexp string to escape.\r\n * @returns {string}\r\n */\r\nexport function escapeRegexp(s: string) {\r\n    if (typeof s !== 'string') {\r\n        throw new TypeError('Expected a string');\r\n    }\r\n\r\n    return s.replace(MATCH_OPERATOR_REGEXP, '\\\\$&');\r\n}\r\n\r\n/**\r\n * Returns the base URL of the app.\r\n *\r\n * @param {Object} w - Window object to use instead of the built in one.\r\n * @returns {string}\r\n */\r\nexport function getBaseUrl(w: Object = window) {\r\n    const doc = w.document;\r\n    const base = doc.querySelector('base');\r\n\r\n    if (base && base.href) {\r\n        return base.href;\r\n    }\r\n\r\n    const { protocol, host } = w.location;\r\n\r\n    return `${protocol}//${host}`;\r\n}\r\n\r\n/**\r\n * Returns the namespace for all global variables, functions, etc that we need.\r\n *\r\n * @returns {Object} The namespace.\r\n *\r\n * NOTE: After React-ifying everything this should be the only global.\r\n */\r\nexport function getJitsiMeetGlobalNS() {\r\n    if (!window.JitsiMeetJS) {\r\n        window.JitsiMeetJS = {};\r\n    }\r\n\r\n    if (!window.JitsiMeetJS.app) {\r\n        window.JitsiMeetJS.app = {};\r\n    }\r\n\r\n    return window.JitsiMeetJS.app;\r\n}\r\n\r\n/**\r\n * Prints the error and reports it to the global error handler.\r\n *\r\n * @param {Error} e - The error object.\r\n * @param {string} msg - A custom message to print in addition to the error.\r\n * @returns {void}\r\n */\r\nexport function reportError(e: Object, msg: string = '') {\r\n    console.error(msg, e);\r\n    window.onerror && window.onerror(msg, null, null, null, e);\r\n}\r\n","/**\r\n * Abstract implementation of analytics handler\r\n */\r\nexport default class AbstractHandler {\r\n    /**\r\n     * Creates new instance.\r\n     *\r\n     * @param {Object} options - Optional parameters.\r\n     */\r\n    constructor(options = {}) {\r\n        this._enabled = false;\r\n        this._whiteListedEvents = options.whiteListedEvents;\r\n\r\n        // FIXME:\r\n        // Keeping the list with the very noisy events so that we don't flood with events whoever hasn't configured\r\n        // white/black lists yet. We need to solve this issue properly by either making these events not so noisy or\r\n        // by removing them completely from the code.\r\n        this._blackListedEvents = [\r\n            ...(options.blackListedEvents || []), // eslint-disable-line no-extra-parens\r\n            'e2e_rtt', 'rtp.stats', 'rtt.by.region', 'available.device', 'stream.switch.delay', 'ice.state.changed',\r\n            'ice.duration', 'peer.conn.status.duration'\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * Extracts a name for the event from the event properties.\r\n     *\r\n     * @param {Object} event - The analytics event.\r\n     * @returns {string} - The extracted name.\r\n     */\r\n    _extractName(event) {\r\n        // Page events have a single 'name' field.\r\n        if (event.type === 'page') {\r\n            return event.name;\r\n        }\r\n\r\n        const {\r\n            action,\r\n            actionSubject,\r\n            source\r\n        } = event;\r\n\r\n        // All events have action, actionSubject, and source fields. All\r\n        // three fields are required, and often jitsi-meet and\r\n        // lib-jitsi-meet use the same value when separate values are not\r\n        // necessary (i.e. event.action == event.actionSubject).\r\n        // Here we concatenate these three fields, but avoid adding the same\r\n        // value twice, because it would only make the event's name harder\r\n        // to read.\r\n        let name = action;\r\n\r\n        if (actionSubject && actionSubject !== action) {\r\n            name = `${actionSubject}.${action}`;\r\n        }\r\n        if (source && source !== action) {\r\n            name = `${source}.${name}`;\r\n        }\r\n\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * Checks if an event should be ignored or not.\r\n     *\r\n     * @param {Object} event - The event.\r\n     * @returns {boolean}\r\n     */\r\n    _shouldIgnore(event) {\r\n        if (!event || !this._enabled) {\r\n            return true;\r\n        }\r\n\r\n        const name = this._extractName(event);\r\n\r\n        if (Array.isArray(this._whiteListedEvents)) {\r\n            return this._whiteListedEvents.indexOf(name) === -1;\r\n        }\r\n\r\n        if (Array.isArray(this._blackListedEvents)) {\r\n            return this._blackListedEvents.indexOf(name) !== -1;\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n"],"sourceRoot":""}